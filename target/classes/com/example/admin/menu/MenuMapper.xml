<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="com.example.admin.menu.MenuMapper">

	<select id="getMenuList" resultType="MenuVO" parameterType="hashMap" statementType="PREPARED" >   
		WITH RECURSIVE cte_name AS (
		    SELECT a.menu_cd , a.created_at, a.updated_at , a.icon_nm , a.lv, a.parent_cd , a.prog_cd, a.sort , a.menu_nm,
		           CAST(LPAD(a.sort, 3, '0') AS CHAR(100)) AS sort_path
		    FROM menu a
		    WHERE a.lv = 0
		    
		    UNION ALL
		    
		    SELECT b.menu_cd , b.created_at, b.updated_at , b.icon_nm , b.lv, b.parent_cd , b.prog_cd, b.sort , b.menu_nm,
		           CONCAT(cte.sort_path, '-', LPAD(b.sort, 3, '0')) AS sort_path
		    FROM menu b
		    INNER JOIN cte_name cte ON b.parent_cd = cte.menu_cd
		    <![CDATA[  WHERE cte.lv < 3  ]]>
		)
		SELECT 
			menu_cd 		menuCd, 
			menu_nm 		menuNm,
			created_at		createAt,
			updated_at		updatedAt,
			icon_nm 		iconNm,
			lv				lv,
			parent_cd 		parentCd,
			prog_cd 		progCd,
			sort 			sort,
			sort_path		sortPath
		FROM cte_name
		ORDER BY sort_path;
    </select>


</mapper>